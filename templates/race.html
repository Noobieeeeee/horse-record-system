<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Race</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/race.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            let isRaceReady = false;
            let leaderboardWindow = null;
            
            // Function to check if leaderboard window exists and is open
            function getLeaderboardWindow() {
                if (!leaderboardWindow || leaderboardWindow.closed) {
                    leaderboardWindow = window.open("{{ url_for('leaderboard_v1') }}", "leaderboard", "width=800,height=600");
                }
                return leaderboardWindow;
            }
            
            $('#race-ready-toggle').change(function() {
                const selectedRacerId = $('#racers').val();
                isRaceReady = $(this).prop('checked');
                
                let lbWindow = getLeaderboardWindow();
                
                if (lbWindow) {
                    if (isRaceReady) {
                        // Update with selected racer details
                        $.get(`/get_racer_details/${selectedRacerId}`, function(data) {
                            lbWindow.updateCurrentRacer(data);
                            $('#race-ready-button').addClass('active');
                        });
                    } else {
                        // Reset to default state
                        lbWindow.resetCurrentRacer();
                        $('#race-ready-button').removeClass('active');
                    }
                    lbWindow.focus(); // Bring leaderboard window to front
                }
            });
        });
    </script>
</head>
<body>
    <h1>Race</h1>
    <div class="container">
        <form>
            <label for="racers">Select Racer:</label>
            <select id="racers" name="racers">
                {% for racer in racers %}
                <option value="{{ racer.id }}">{{ racer.name }}</option>
                {% endfor %}
            </select>
            <input type="checkbox" id="race-ready-toggle" class="hidden-checkbox">
            <label for="race-ready-toggle" class="button" id="race-ready-button">Race Ready</label>
            <button type="button" id="start-race-button">Start Race</button>
        </form>
        <form action="{{ url_for('index') }}" method="get">
            <button type="submit" id="button-back-main">Back to Main</button>
        </form>
    </div>
</body>
</html>